# v33.1 PR Merge Campaign Documentation

This directory contains documentation and scripts for the v33.1 housekeeping PR merge campaign.

## Purpose

Merge and/or close all open PRs related to:
- **Security fixes** (PR #24)
- **Obsolete PRs** (PR #14 - close)
- **CI/CD upgrades** (PRs #23, #19, #22, #21, #18) - Node.js 24 + Python updates
- **Dependencies** (PR #20) - FastAPI 0.129.0
- **Test fixes** (PR #26) - 11 CI test failures + mypy errors

## Documents

### 1. **v33.1-pr-merge-guide.md**
Comprehensive execution guide with:
- Current PR status table
- Step-by-step merge sequence
- GitHub CLI commands
- Web UI alternatives
- Troubleshooting tips
- Timeline estimates

**Use this for:** Understanding the full process and reference

### 2. **scripts/merge-v33.1-prs.sh**
Automated bash script that:
- Validates environment (gh CLI, auth)
- Executes merge sequence
- Handles Dependabot rebase requests
- Provides colored output and error handling

**Use this for:** Automated execution (where possible)

**Usage:**
```bash
cd /home/runner/work/loofi-fedora-tweaks/loofi-fedora-tweaks
bash scripts/merge-v33.1-prs.sh
```

### 3. **v33.1-pr-merge-checklist.md**
Printable checklist for tracking:
- Each step's completion status
- Timestamps
- Merge SHAs
- CI status
- Issues encountered

**Use this for:** Manual tracking and audit trail

## Quick Start

### Option A: Automated (Recommended)
```bash
# From repository root
bash scripts/merge-v33.1-prs.sh
```

This will:
1. Undraft and merge PR #24 (security)
2. Close PR #14 (obsolete)
3. Request Dependabot rebases for PRs #23, #19
4. Merge PRs #23, #19, #22, #21, #18 (CI/CD)
5. Merge PR #20 (fastapi)
6. Provide instructions for manual PR #26 rebase/merge

### Option B: Manual Step-by-Step
```bash
# Follow the guide
cat v33.1-pr-merge-guide.md

# Use checklist to track
cat v33.1-pr-merge-checklist.md
```

Execute each command from the guide, checking off items in the checklist.

## Prerequisites

- **GitHub CLI** (`gh`) installed and authenticated
  ```bash
  gh --version
  gh auth status
  ```
- **Repository access** with merge permissions
- **Time**: Allow 90-120 minutes for full sequence

## Important Notes

### Why This Order?
1. **Security first** (PR #24) - Critical fix takes priority
2. **Remove obsolete** (PR #14) - Avoid confusion
3. **CI/CD sequential** (PRs #23→#19→#22→#21→#18) - Update checkout first, then other actions
4. **Dependencies** (PR #20) - After CI stabilizes
5. **Tests last** (PR #26) - Fixes issues from all prior merges

### CI Wait Times
Each merge must wait for CI to pass before proceeding. Typical times:
- **Lint**: 2-3 minutes
- **Tests**: 5-7 minutes
- **Build**: 3-5 minutes
- **Total per PR**: 10-15 minutes

### Merge Conflicts
If conflicts occur during rebases:
- **Workflow files** (`.github/workflows/*.yml`): Usually safe to accept master's version
- **Dependency files** (`requirements.txt`, `pyproject.toml`): Prefer PR's version (newer deps)
- **Test files**: Manual resolution required

## Post-Merge Tasks

After all merges complete:

1. **Update CHANGELOG.md**
   ```bash
   # Add section for v33.1
   # - Security: PR #24
   # - CI/CD: PRs #23, #19, #22, #21, #18
   # - Dependencies: PR #20
   # - Tests: PR #26
   ```

2. **Verify master CI**
   ```bash
   gh run list --limit 5
   gh run view <LATEST_RUN_ID>
   ```

3. **Clean stale branches** (optional)
   ```bash
   git branch -r --merged origin/master | grep -v master
   ```

4. **Document in issue**
   Add completion comment to the tracking issue with:
   - All merged PR numbers
   - Final master CI status
   - Any issues encountered

## Troubleshooting

### Dependabot Not Rebasing
If `@dependabot rebase` doesn't work within 5 minutes:
```bash
# Fallback: manual rebase
gh pr checkout <PR_NUMBER>
git fetch origin master
git rebase origin/master
git push origin <BRANCH_NAME> --force-with-lease
```

### CI Failures
1. View logs: `gh run view <RUN_ID>`
2. If persistent, consider reverting: `git revert <COMMIT_SHA>`
3. Fix forward in new PR if needed

### Script Errors
The automated script will stop on errors (`set -e`). To continue manually:
1. Check which step failed in the output
2. Fix the issue (e.g., resolve conflicts, undraft manually)
3. Resume from that step in the guide

## Support

For questions or issues:
1. Check `v33.1-pr-merge-guide.md` troubleshooting section
2. Review PR status: `gh pr list --state open`
3. Check CI logs: `gh run list --limit 10`

## Success Criteria

✅ All criteria must be met:
- [ ] 8 PRs merged (#24, #23, #19, #22, #21, #18, #20, #26)
- [ ] 1 PR closed (#14)
- [ ] Master CI passing
- [ ] CHANGELOG.md updated
- [ ] No open Dependabot PRs for handled actions

---

**Generated for:** v33.1 Housekeeping Campaign  
**Date:** 2026-02-14  
**Repository:** loofitheboss/loofi-fedora-tweaks
