# v33.1 PR Merge Campaign — Execution Guide

## Overview
This document provides the complete execution plan for merging 9 PRs in the correct order for v33.1 housekeeping.

## Current PR Status

| PR # | Title | Status | Mergeable | Conflicts | Draft | Action Required |
|------|-------|--------|-----------|-----------|-------|-----------------|
| #24 | Fix command injection vulnerabilities | Open | ✅ Yes | ❌ No | ✅ Yes | Undraft, then merge |
| #14 | Potential fix for code scanning alert no. 2 | Open | ✅ Yes | ❌ No | ✅ Yes | Close (obsoleted by #24) |
| #23 | ci: bump actions/checkout from 4 to 6 | Open | ⚠️ Behind | ❌ No | ❌ No | Rebase via @dependabot |
| #19 | ci: bump actions/upload-artifact from 4 to 6 | Open | ❌ No | ✅ Yes | ❌ No | Rebase via @dependabot |
| #22 | ci: bump peter-evans/create-pull-request 7→8 | Open | ✅ Yes | ❌ No | ❌ No | Ready to merge |
| #21 | ci: bump actions/ai-inference from 1 to 2 | Open | ✅ Yes | ❌ No | ❌ No | Ready to merge |
| #18 | ci: bump actions/stale from 9 to 10 | Open | ✅ Yes | ❌ No | ❌ No | Ready to merge |
| #20 | deps: bump fastapi from 0.128.5 to 0.129.0 | Open | ✅ Yes | ❌ No | ❌ No | Ready to merge |
| #26 | Fix 11 CI test failures and mypy type errors | Open | ❌ No | ✅ Yes | ✅ Yes | Rebase after others merge |

## Execution Sequence

### Phase 1: Security Fix
**Priority:** CRITICAL

#### Step 1.1: Undraft PR #24
```bash
gh pr ready 24
```
**Alternative (Web UI):**
1. Go to https://github.com/loofitheboss/loofi-fedora-tweaks/pull/24
2. Click "Ready for review" button

#### Step 1.2: Merge PR #24
```bash
gh pr merge 24 --squash --auto
```
**Alternative (Web UI):**
1. Review checks (wait if needed)
2. Click "Squash and merge"
3. Confirm merge

**Wait for:** CI to pass and master build to complete

---

### Phase 2: Close Obsolete PR
**Priority:** HIGH

#### Step 2.1: Close PR #14
```bash
gh pr close 14 --comment "Closing in favor of comprehensive fix in PR #24"
```
**Alternative (Web UI):**
1. Go to https://github.com/loofitheboss/loofi-fedora-tweaks/pull/14
2. Add comment: "Closing in favor of comprehensive fix in PR #24"
3. Click "Close pull request"

---

### Phase 3: CI/CD Action Upgrades
**Priority:** MEDIUM-HIGH

#### Step 3.1: Rebase PR #23 (checkout)
**Add comment to trigger Dependabot rebase:**
```bash
gh pr comment 23 --body "@dependabot rebase"
```
**Alternative (Web UI):**
1. Go to https://github.com/loofitheboss/loofi-fedora-tweaks/pull/23
2. Add comment: `@dependabot rebase`

**Wait for:** Dependabot to rebase (watch for notification)

#### Step 3.2: Merge PR #23
```bash
gh pr merge 23 --squash --auto
```
**Wait for:** CI to pass and master build

---

#### Step 4.1: Rebase PR #19 (upload-artifact)
```bash
gh pr comment 19 --body "@dependabot rebase"
```

**Wait for:** Dependabot rebase completion

#### Step 4.2: Merge PR #19
```bash
gh pr merge 19 --squash --auto
```
**Wait for:** CI to pass and master build

---

#### Step 5: Merge PR #22 (create-pull-request)
```bash
gh pr merge 22 --squash --auto
```
**Wait for:** CI to pass and master build

---

#### Step 6: Merge PR #21 (ai-inference)
```bash
gh pr merge 21 --squash --auto
```
**Wait for:** CI to pass and master build

---

#### Step 7: Merge PR #18 (stale)
```bash
gh pr merge 18 --squash --auto
```
**Wait for:** CI to pass and master build

---

### Phase 4: Dependency Updates
**Priority:** MEDIUM

#### Step 8: Merge PR #20 (fastapi 0.129.0)
```bash
gh pr merge 20 --squash --auto
```
**Wait for:** CI to pass and master build

**Note:** FastAPI 0.129.0 drops Python 3.9 support. Ensure this aligns with project requirements (pyproject.toml already requires Python 3.12+).

---

### Phase 5: Test & Type Fixes
**Priority:** HIGH

#### Step 9.1: Rebase PR #26 (test fixes)
Once all previous PRs are merged, rebase PR #26:

```bash
# Checkout the PR branch locally
gh pr checkout 26

# Fetch latest master
git fetch origin master

# Rebase onto master
git rebase origin/master

# Resolve any conflicts if they occur
# Then force push
git push origin copilot/fix-all-pull-requests --force-with-lease
```

**Wait for:** Conflicts resolved, CI passes

#### Step 9.2: Undraft PR #26
```bash
gh pr ready 26
```

#### Step 9.3: Merge PR #26
```bash
gh pr merge 26 --squash --auto
```

---

## Post-Merge Housekeeping

### Verify CI Status
```bash
gh workflow list
gh run list --limit 5
```

### Check for Stale Branches
```bash
gh pr list --state closed --limit 20
git branch -r --merged origin/master | grep -v master
```

### Update CHANGELOG
Manual step — document all merged PRs in CHANGELOG.md:
- Security fixes (PR #24)
- CI/CD upgrades (PRs #23, #19, #22, #21, #18)
- Dependency updates (PR #20)
- Test/type fixes (PR #26)

### Trigger Release Workflow (if configured)
```bash
gh workflow run auto-release.yml
```

---

## Troubleshooting

### Dependabot Rebase Not Responding
If `@dependabot rebase` comment doesn't trigger within 5 minutes:
1. Check Dependabot security settings
2. Try `@dependabot recreate` instead
3. Manual rebase fallback:
   ```bash
   gh pr checkout <PR_NUMBER>
   git fetch origin master
   git rebase origin/master
   git push origin <BRANCH_NAME> --force-with-lease
   ```

### Merge Conflicts During Rebase
1. Resolve conflicts in the files indicated
2. For workflow files, prefer master's version unless PR adds new features
3. For dependency files, prefer PR's version (newer dependencies)
4. Run tests locally before pushing

### CI Failures After Merge
1. Check workflow logs: `gh run view <RUN_ID>`
2. If test failures, consider reverting: `git revert <COMMIT_SHA>`
3. Fix forward in a new PR if revert needed

---

## Success Criteria

- [x] All 9 PRs processed (8 merged, 1 closed)
- [ ] Master CI passing after final merge
- [ ] No open Dependabot PRs for actions/deps handled here
- [ ] CHANGELOG.md updated with all changes
- [ ] Release notes drafted (if applicable)

---

## Timeline Estimate

- Phase 1 (Security): 10-15 minutes
- Phase 2 (Close PR): 2 minutes
- Phase 3 (CI/CD): 45-60 minutes (includes rebase wait times)
- Phase 4 (Dependencies): 10 minutes
- Phase 5 (Tests): 15-20 minutes (rebase + merge)
- Post-merge: 15-20 minutes

**Total: ~90-120 minutes** (mostly waiting for CI between merges)

---

## Notes

- **Why Squash Merges?** Keeps master history clean with one commit per feature/fix
- **Why Sequential?** Ensures each change passes CI independently before next merge
- **Why Wait Between Merges?** Allows CI to catch integration issues early

